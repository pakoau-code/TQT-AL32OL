<!doctype html>
<html lang="es"><head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Cálculo de inyección de policloruro (AL-32OL)</title>

<!-- PWA -->
<link rel="manifest" href="manifest.webmanifest">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#111827">

<style>
:root { --brand:#111827; --border:#e5e7eb; --bg:#ffffff; --muted:#6b7280; --accent:#f3f4f6; }
* { box-sizing: border-box; }
body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); margin:0; padding:16px; }
.wrap { max-width:760px; margin:0 auto; }
.header { text-align:center; margin-bottom:12px; }
.logo { width:220px; height:auto; display:inline-block; }
.title { margin-top:6px; font-weight:800; letter-spacing:.3px; font-size:18px; }
.card { border:1px solid var(--border); border-radius:14px; padding:16px; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.03); }
label { display:block; margin:8px 0 6px; font-weight:600; }
input, button { width:100%; padding:12px; font-size:16px; border:1px solid var(--border); border-radius:10px; }
button { background:var(--brand); color:#fff; border-color:#111; cursor:pointer; margin-top:10px; }
.result { background:var(--accent); border-radius:12px; padding:12px; margin-top:12px; }
.grid { display:grid; grid-template-columns:1fr; gap:10px; }
.pill { padding:10px; border-radius:12px; background:#fff; border:1px solid var(--border); }
.kv { display:flex; align-items:center; justify-content:space-between; }
.k { font-size:13px; color:var(--muted); }
.v { font-weight:800; font-size:20px; }
.pumps { display:grid; grid-template-columns:repeat(2,1fr); gap:8px; }
@media (min-width:680px) { .pumps { grid-template-columns:repeat(4,1fr); } }
.footer { margin-top:10px; color:var(--muted); font-size:12px; text-align:center; }
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <img src="logo-tqt.png" class="logo" alt="CONSORCIO TQT" />
    <div class="title">CÁLCULO DE INYECCIÓN DE POLICLORURO (AL-32OL)</div>
    <div class="k">Dilución fija 6000 L | 4 bombas × 215 L/h</div>
  </div>

  <div class="card">
    <label for="ntu">Turbidez (NTU)</label>
    <input id="ntu" type="text" inputmode="decimal" placeholder="ej. 2000" />

    <label for="flow">Caudal (m³/h)</label>
    <input id="flow" type="text" inputmode="decimal" placeholder="ej. 300" />

    <label for="kg">Policloruro a diluir (kg) en 6000 L</label>
    <input id="kg" type="text" inputmode="decimal" placeholder="ej. 1250" />

    <button id="btn" type="button" onclick="calc()">Calcular</button>

    <div id="out" class="result" style="display:none"></div>
    <div class="footer">Fórmula: ppm = 0.0213·NTU + 15.233 (×0.96 para dosificación)</div>
  </div>
</div>

<script>
// Registrar Service Worker (PWA)
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./service-worker.js');
  });
}

var m = 0.0213;
var b = 15.233;
var VOL = 6000.0;
var N = 4;
var CAP = 215.0;
var FC = 0.96;

function normalize(v) { v = String(v||'').trim().replace(',', '.'); var x = parseFloat(v); return isNaN(x) ? 0 : x; }
function ppmBase(ntu) { var res = m*ntu + b; return res > 0 ? res : 0; }
function ppmDosif(ntu) { return ppmBase(ntu) * FC; }

// Secuencial: B1->B2->B3->B4 (0-100% cada una)
function distribSecuencial(Lh_required, cap) {
  var percs = [0,0,0,0];
  var remain = Lh_required;
  for (var i=0;i<N;i++) { if (remain<=0) break; var take = Math.min(remain, cap); percs[i] = Math.round((take/cap)*100); remain -= take; }
  return percs;
}

function calc() {
  var ntu = normalize(document.getElementById('ntu').value);
  var flow = normalize(document.getElementById('flow').value);
  var kg = normalize(document.getElementById('kg').value);
  var ppm_d = ppmDosif(ntu);
  var conc_mgL = kg>0 ? (kg*1e6)/VOL : 0;
  var Lh_flow = flow*1000.0;
  var chem_Lh = conc_mgL>0 ? (Lh_flow*ppm_d)/conc_mgL : 0;
  var open = distribSecuencial(chem_Lh, CAP);
  var supplied = 0; for (var i=0;i<N;i++) supplied += (open[i]/100)*CAP;

  var html = '';
  html += '<div class="grid">';
  html += '<div class="pill"><div class="kv"><div class="k">PPM requeridos (ajustados)</div><div class="v">' + ppm_d.toFixed(2) + '</div></div></div>';
  html += '<div class="pill"><div class="kv"><div class="k">Dosificación requerida</div><div class="v">' + chem_Lh.toFixed(2) + ' L/h</div></div></div>';
  html += '<div class="pill"><div class="k" style="margin-bottom:6px;">Apertura sugerida (4 bombas × ' + CAP + ' L/h)</div>';
  html +=   '<div class="pumps">';
  for (var i=0;i<N;i++) { html += '<div class="pill"><div class="k">Bomba #' + (i+1) + '</div><div class="v" style="font-size:18px;">' + open[i] + '%</div></div>'; }
  html +=   '</div></div>';
  html += '<div class="pill"><div class="kv"><div class="k">Suministro estimado</div><div class="v">' + supplied.toFixed(1) + ' L/h</div></div>';
  html += '<div class="k">De ' + chem_Lh.toFixed(1) + ' L/h requeridos.</div></div>';
  html += '</div>';

  var out = document.getElementById('out');
  out.style.display = 'block';
  out.innerHTML = html;
}
</script>
</body></html>
